<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link rel="stylesheet" href="../assets/css/common.css" />
    <script src="https://code.jquery.com/jquery-3.7.0.min.js" crossorigin="anonymous"></script>
</head>

<body>
    <!-- input text -->
    <div class="inp" style="width: 200px">
        <label for="">input text</label>
        <div class="inp-group">
            <input type="text" class="change-text" style="font-size: 24px" value="" />
        </div>
    </div>
    <hr />
    <!-- input select -->
    <div class="inp">
        <label for="">input select</label>
        <button type="button" role="">선택</button>
    </div>
    <hr />
    <!-- checkbox -->
    <div class="inp-check">
        <input type="checkbox" />
        <label for="">abc</label>
    </div>
    <hr />
    <!-- radio -->
    <div class="inp-radio">
        <input type="radio" />
        <label for="">radio</label>
    </div>

    <hr />
    <!-- stack -->
    <div class="inp-stack ani">
        <!-- input text -->
        <div class="inp">
            <label for="">1</label>
            <input type="text" />
        </div>

        <!-- input select -->
        <div class="inp">
            <label for="">2
                <br />2
            </label>
            <button type="button" role="">선택</button>
        </div>

        <!-- input select -->
        <div class="inp">
            <label for="">3</label>
            <button type="button" role="">선택</button>
        </div>

        <span class="inp-focus"></span>
    </div>

    <button type="button" class="stack-btn">stack focus</button>
    <button type="button" class="focus-btn">inp focus</button>
    <button type="button" class="error-btn">inp error</button>

    <script>
        "use strict";
        $(function() {
            const $stackBtn = $(".stack-btn");
            let count = 0;

            $(".inp-stack .inp").eq(0).stack();

            $stackBtn.on("click", function(e) {
                e.preventDefault();
                count = count < $(".inp-stack .inp").length ? (count += 1) : count;
                $(".inp-stack .inp").eq(count).stack();
            });

            $(".focus-btn").on("click", function(e) {
                e.preventDefault();
                $(".inp").addFocus();
            });

            $(".error-btn").on("click", function(e) {
                e.preventDefault();
                $(".inp").addError();
            });

            // change text field
            const $changeInp = $(".change-text");
            const fontSize = Number(
                $(".change-text").css("font-size").replace("px", "")
            );
            const $dummyDiv = $(
                `<div class="dummy-text" style="position:absolute;left:0;font-size:${fontSize}px;visibility:hidden;z-index:-1;" />`
            );
            $changeInp.after($dummyDiv);

            $changeInp.on("keyup", function(e) {
                const $this = $(this);
                const val = $this.val();
                const w = $this.outerWidth();
                const testW = $dummyDiv.outerWidth();
                const ratio = w / testW;
                let size = fontSize * ratio;

                size = Math.min(fontSize, Math.max(0, Math.floor(size) - 0.5));
                $dummyDiv.text(val);
                $this.css("font-size", size);
            });
        });

        $.fn.extend({
            addSuccess: function() {
                return this.each(function() {
                    const $this = $(this);
                    $this.addClass("success").find("input").focus();
                });
            },
            addError: function() {
                return this.each(function() {
                    const $this = $(this);
                    $this.addClass("error").find("input").focus();
                });
            },
            addFocus: function() {
                return this.each(function() {
                    const $this = $(this);
                    $this.addClass("focus").find("input").focus();
                });
            },
            stack: function() {
                return this.each(function() {
                    const $this = $(this);
                    const $parent = $this.closest(".inp-stack");
                    let itemH = 0;

                    if ($this.prevAll().length) {
                        itemH += $this.outerHeight();
                        $this.prevAll().each(function(i, el) {
                            itemH += $(el).outerHeight();
                        });
                    } else {
                        itemH = $parent.find(".inp").eq(0).outerHeight();
                    }

                    $this
                        .addClass("focus show")
                        .siblings()
                        .removeClass("focus")
                        .closest(".inp-stack")
                        .css({
                            "--stack-height": `${itemH}px`
                        });
                });
            },
        });
        // $.fn.stack = function(){
        //     return this.each(function(){
        //         const $this = $(this);
        //         const $parent = $this.closest('.inp-stack');
        //         let itemH = 0;

        //         if ( $this.prevAll().length ) {
        //             itemH += $this.outerHeight();
        //             $this.prevAll().each(function(i, el){
        //                 itemH += $(el).outerHeight();
        //             });
        //         } else {
        //             itemH = $parent.find('.inp').eq(0).outerHeight();
        //         }

        //         $this
        //         .addClass('active focus').siblings().removeClass('focus')
        //         .closest('.inp-stack').css({'--stack-height': `${itemH}px`});

        //     });
        // }
    </script>

    <div style="width: 52px; height: 52px">
        <i class="icon icon-add-plus"></i>
    </div>
    <div style="width: 52px; height: 52px">
        <i class="icon icon-check"></i>
    </div>

    <footer class="footer"></footer>
</body>

</html>